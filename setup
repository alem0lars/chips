#!/usr/bin/env ruby


# ──────────────────────────────────────────────────────────── Configuration ──┐
ROOT_DIR = File.dirname(File.expand_path(__FILE__))

$:.unshift ROOT_DIR
require "sfw"

SCRIPTS_DIR = ROOT_DIR.to_pn.join("scripts")
DEST_DIR    = "/usr/local/bin".to_pn
# ─────────────────────────────────────────────────────────────────────────────┘

# ──────────────────────────────────────────────────────────────────── Utils ──┐
def copy_chips(category, simulate)
  Pathname.glob(SCRIPTS_DIR.join(category.to_s).join("*")) do |chip_src_path|
    "installing chip `#{chip_src_path.basename}`..".pinf
    chip_dst_path = DEST_DIR.join(chip_src_path.basename)
    chip_src_path.build_script to: chip_dst_path, simulate: simulate
  end
end
# ─────────────────────────────────────────────────────────────────────────────┘

# ────────────────────────────────────────────────────────────── Entry Point ──┐
simulate = "simulate setup".ask type: :bool
ensure_root unless simulate
categories = Pathname.glob(SCRIPTS_DIR.join("*")).map do |category_path|
  category_path.basename.to_s
end

categories.each do |category|
  if "include #{category}".ask type: :bool
    copy_chips category, simulate
  end
end
# ─────────────────────────────────────────────────────────────────────────────┘


# vim: set filetype=ruby :
